#!/bin/bash
# Merchant Status Fix Script for Linux/Mac

echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
echo "โ      ๐ง ุฅุตูุงุญ ูุดููุฉ ุญุงูุฉ ุงูุชุงุฌุฑ - Merchant Status Fix    โ"
echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
echo ""

# Colors
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
NC='\033[0m' # No Color

# Step 1: Check current directory
echo "[1/5] ๐ ุงูุชุญูู ูู ุงููุฌูุฏ ุงูุญุงูู..."
cd "$(dirname "$0")"
echo "โ ุงููุฌูุฏ: $(pwd)"
echo ""

# Step 2: Activate virtual environment
echo "[2/5] ๐ ุชูุนูู ุงูุจูุฆุฉ ุงูุงูุชุฑุงุถูุฉ..."
if [ -d "venv" ]; then
    source venv/bin/activate
    if [ $? -eq 0 ]; then
        echo "โ ุชู ุชูุนูู ุงูุจูุฆุฉ ุงูุงูุชุฑุงุถูุฉ"
    else
        echo -e "${RED}โ ูุดู ุชูุนูู ุงูุจูุฆุฉ ุงูุงูุชุฑุงุถูุฉ${NC}"
        exit 1
    fi
else
    echo -e "${RED}โ ูุฌูุฏ venv ุบูุฑ ููุฌูุฏ${NC}"
    echo "๐ก ูู ุจุฅูุดุงุฆู ุฃููุงู: python -m venv venv"
    exit 1
fi
echo ""

# Step 3: Run system check
echo "[3/5] ๐ ุชุดุบูู ูุญุต ุงููุธุงู ุงูุดุงูู..."
python system_check.py
if [ $? -ne 0 ]; then
    echo -e "${RED}โ ุญุฏุซ ุฎุทุฃ ูู ูุญุต ุงููุธุงู${NC}"
    exit 1
fi
echo ""

# Step 4: Create and apply migrations
echo "[4/5] ๐ฆ ุฅูุดุงุก ูุชุทุจูู Migration..."
echo ""
python manage.py makemigrations api
if [ $? -ne 0 ]; then
    echo -e "${RED}โ ูุดู ุฅูุดุงุก migration${NC}"
    exit 1
fi
echo ""
python manage.py migrate
if [ $? -ne 0 ]; then
    echo -e "${RED}โ ูุดู ุชุทุจูู migration${NC}"
    exit 1
fi
echo "โ ุชู ุชุทุจูู Migration ุจูุฌุงุญ"
echo ""

# Step 5: Run fix script
echo "[5/5] ๐ง ุชุดุบูู ุณูุฑูุจุช ุงูุฅุตูุงุญ..."
python fix_merchant_status.py
if [ $? -ne 0 ]; then
    echo -e "${RED}โ ุญุฏุซ ุฎุทุฃ ูู ุณูุฑูุจุช ุงูุฅุตูุงุญ${NC}"
    exit 1
fi
echo ""

# Success message
echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
echo "โ                  โ ุงูุชูู ุงูุฅุตูุงุญ ุจูุฌุงุญ!                  โ"
echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
echo ""
echo "๐ ุชู ุฅุตูุงุญ ูุดููุฉ ุญุงูุฉ ุงูุชุงุฌุฑ ุจูุฌุงุญ!"
echo ""
echo "๐ก ุงูุฎุทูุงุช ุงูุชุงููุฉ:"
echo "   1. ุชุดุบูู ุงูุฎุงุฏู: python manage.py runserver"
echo "   2. ุงุฎุชุจุงุฑ ุฅูุดุงุก ุนุฑุถ ุฌุฏูุฏ ูู ุงูุชุทุจูู"
echo "   3. ูุฑุงุฌุนุฉ ููู error.log ููุชุฃูุฏ ูู ุนุฏู ูุฌูุฏ ุฃุฎุทุงุก"
echo ""
