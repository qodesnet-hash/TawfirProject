ØªÙ… ØªØ´Ø®ÙŠØµ Ø§Ù„Ù…Ø´ÙƒÙ„Ø©: Ø®Ø·Ø£ 401 Unauthorized

Ø§Ù„Ø³Ø¨Ø¨ Ø§Ù„Ù…Ø­ØªÙ…Ù„:
Ø§Ù„ØªÙˆÙƒÙ† (Token) Ø§Ù„Ø°ÙŠ ÙŠØªÙ… Ø¥Ø±Ø³Ø§Ù„Ù‡ Ø¥Ù„Ù‰ Ø§Ù„Ù€ Backend ØºÙŠØ± ØµØ­ÙŠØ­ Ø£Ùˆ Ù…Ù†ØªÙ‡ÙŠ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ©.

Ø§Ù„Ø­Ù„ Ø§Ù„Ù…Ù‚ØªØ±Ø­:

ÙÙŠ Ù…Ù„Ù: tawfir_app/src/app/pages/auth-gmail/auth-gmail.page.ts

Ø§Ø³ØªØ¨Ø¯Ù„ Ø¯Ø§Ù„Ø© completeSignup() Ø¨Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„ØªØ§Ù„ÙŠ:

```typescript
// Complete signup
async completeSignup() {
  // Validate required fields
  if (!this.userData.city_id) {
    await this.showToast('ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©', 'warning');
    return;
  }
  
  // For merchants, location is required
  if (this.userType === 'merchant' && (!this.userData.latitude || !this.userData.longitude)) {
    const alert = await this.alertCtrl.create({
      header: 'ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ù…Ø·Ù„ÙˆØ¨',
      message: 'ÙŠØ¬Ø¨ ØªØ­Ø¯ÙŠØ¯ Ù…ÙˆÙ‚Ø¹ Ù…ØªØ¬Ø±Ùƒ Ù„Ø¹Ø±Ø¶ Ø§Ù„Ø¹Ø±ÙˆØ¶ Ù„Ù„Ø¹Ù…Ù„Ø§Ø¡ Ø§Ù„Ù‚Ø±ÙŠØ¨ÙŠÙ†',
      buttons: [
        {
          text: 'ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹',
          handler: () => {
            this.getCurrentLocation();
          }
        },
        {
          text: 'Ø¥Ù„ØºØ§Ø¡',
          role: 'cancel'
        }
      ]
    });
    await alert.present();
    return;
  }
  
  const loading = await this.loadingCtrl.create({
    message: 'Ø¬Ø§Ø±ÙŠ Ø¥ÙƒÙ…Ø§Ù„ Ø§Ù„ØªØ³Ø¬ÙŠÙ„...',
    cssClass: 'custom-loading'
  });
  await loading.present();
  
  try {
    // Get token with detailed logging
    const token = await this.authService.getToken();
    console.log('Token retrieved:', token ? 'Token exists' : 'Token is null');
    console.log('Full token:', token); // Ø³ÙŠØ¸Ù‡Ø± Ø§Ù„ØªÙˆÙƒÙ† Ø§Ù„ÙƒØ§Ù…Ù„ ÙÙŠ console
    
    if (!token) {
      await loading.dismiss();
      await this.showToast('Ø®Ø·Ø£: Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø±Ù…Ø² Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø©. ÙŠØ±Ø¬Ù‰ Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰', 'danger');
      this.currentStep = 1;
      return;
    }
    
    const headers = new HttpHeaders({
      'Authorization': `Bearer ${token}`,
      'Content-Type': 'application/json'
    });
    
    console.log('Completing profile with data:', this.userData);
    console.log('Authorization header set');
    
    this.http.post<any>(
      `${this.apiUrl}/api/v1/auth/api/complete-profile/`,
      this.userData,
      { headers }
    ).subscribe({
      next: async (response) => {
        console.log('Profile completion response:', response);
        
        if (response.success) {
          // For merchants, update location
          if (this.userType === 'merchant' && this.userData.latitude) {
            await this.updateMerchantLocation(headers);
          }
          
          await loading.dismiss();
          
          // Show success message
          if (this.userType === 'merchant') {
            await this.showSuccessAlert(
              'ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø·Ù„Ø¨Ùƒ!',
              'Ø³ÙŠØªÙ… Ù…Ø±Ø§Ø¬Ø¹Ø© Ø·Ù„Ø¨Ùƒ ÙˆØªÙØ¹ÙŠÙ„ Ø­Ø³Ø§Ø¨Ùƒ Ø®Ù„Ø§Ù„ 24 Ø³Ø§Ø¹Ø©',
              'Ø³Ù†Ø±Ø³Ù„ Ù„Ùƒ Ø¥Ø´Ø¹Ø§Ø±Ø§Ù‹ Ø¹Ù†Ø¯ ØªÙØ¹ÙŠÙ„ Ø­Ø³Ø§Ø¨Ùƒ'
            );
          } else {
            await this.showToast('Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ ÙÙŠ ØªÙˆÙÙŠØ±! ğŸ‰', 'success');
          }
          
          // Navigate to app
          setTimeout(() => {
            this.router.navigate(['/tabs/tab1']);
          }, 2000);
        } else {
          await loading.dismiss();
          await this.showToast('ÙØ´Ù„ Ø¥ÙƒÙ…Ø§Ù„ Ø§Ù„ØªØ³Ø¬ÙŠÙ„', 'danger');
        }
      },
      error: async (error) => {
        await loading.dismiss();
        console.error('Profile completion error:', error);
        console.error('Error status:', error.status);
        console.error('Error details:', error.error);
        
        let errorMessage = 'Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø¥ÙƒÙ…Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª';
        
        if (error.status === 401) {
          errorMessage = 'Ø§Ù†ØªÙ‡Øª ØµÙ„Ø§Ø­ÙŠØ© Ø§Ù„Ø¬Ù„Ø³Ø©. ÙŠØ±Ø¬Ù‰ Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰';
          // Reset to step 1
          this.currentStep = 1;
          this.googleUser = null;
        } else if (error.error?.error) {
          errorMessage = error.error.error;
        }
        
        await this.showToast(errorMessage, 'danger');
      }
    });
  } catch (error: any) {
    await loading.dismiss();
    console.error('Complete signup error:', error);
    await this.showToast('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø¥ÙƒÙ…Ø§Ù„ Ø§Ù„ØªØ³Ø¬ÙŠÙ„', 'danger');
  }
}
```

Ø§Ù„Ø¢Ù† Ø¬Ø±Ù‘Ø¨ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰ ÙˆØ±Ø§Ù‚Ø¨ Ø§Ù„Ù€ console:
1. ØªØ£ÙƒØ¯ Ù…Ù† Ø£Ù† "Token retrieved: Token exists" ÙŠØ¸Ù‡Ø±
2. Ø§Ù†Ø¸Ø± Ø¥Ù„Ù‰ Ø§Ù„ØªÙˆÙƒÙ† Ø§Ù„ÙƒØ§Ù…Ù„ Ø§Ù„Ù…Ø·Ø¨ÙˆØ¹
3. Ø§ÙØ­Øµ Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ø®Ø·Ø£ Ø¨Ø§Ù„ØªÙØµÙŠÙ„
