// QUICK FIX - ÙÙŠ Ø§Ù„Ø³Ø·Ø± 446 ØªÙ‚Ø±ÙŠØ¨Ø§Ù‹ØŒ Ø§Ø³ØªØ¨Ø¯Ù„ Ø¯Ø§Ù„Ø© completeSignup Ø¨Ù‡Ø°Ø§:

async completeSignup() {
  if (!this.userData.city_id) {
    await this.showToast('ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©', 'warning');
    return;
  }
  
  if (this.userType === 'merchant' && (!this.userData.latitude || !this.userData.longitude)) {
    const alert = await this.alertCtrl.create({
      header: 'ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ù…Ø·Ù„ÙˆØ¨',
      message: 'ÙŠØ¬Ø¨ ØªØ­Ø¯ÙŠØ¯ Ù…ÙˆÙ‚Ø¹ Ù…ØªØ¬Ø±Ùƒ Ù„Ø¹Ø±Ø¶ Ø§Ù„Ø¹Ø±ÙˆØ¶ Ù„Ù„Ø¹Ù…Ù„Ø§Ø¡ Ø§Ù„Ù‚Ø±ÙŠØ¨ÙŠÙ†',
      buttons: [{text: 'ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹', handler: () => this.getCurrentLocation()}, {text: 'Ø¥Ù„ØºØ§Ø¡', role: 'cancel'}]
    });
    await alert.present();
    return;
  }
  
  const loading = await this.loadingCtrl.create({message: 'Ø¬Ø§Ø±ÙŠ Ø¥ÙƒÙ…Ø§Ù„ Ø§Ù„ØªØ³Ø¬ÙŠÙ„...', cssClass: 'custom-loading'});
  await loading.present();
  
  try {
    // Send email with data - no token needed
    console.log('Completing profile with data:', this.userData);
    
    this.http.post<any>(`${this.apiUrl}/api/v1/auth/api/complete-profile/`, this.userData).subscribe({
      next: async (response) => {
        console.log('Profile completion response:', response);
        
        if (response.success) {
          if (this.userType === 'merchant' && this.userData.latitude) {
            // Update merchant location
            await this.http.post<any>(`${this.apiUrl}/api/v1/auth/api/merchant/update-location/`, {
              email: this.userData.email,
              latitude: this.userData.latitude,
              longitude: this.userData.longitude,
              address: this.userData.address
            }).toPromise();
          }
          
          await loading.dismiss();
          
          if (this.userType === 'merchant') {
            await this.showSuccessAlert('ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø·Ù„Ø¨Ùƒ!', 'Ø³ÙŠØªÙ… Ù…Ø±Ø§Ø¬Ø¹Ø© Ø·Ù„Ø¨Ùƒ ÙˆØªÙØ¹ÙŠÙ„ Ø­Ø³Ø§Ø¨Ùƒ Ø®Ù„Ø§Ù„ 24 Ø³Ø§Ø¹Ø©');
          } else {
            await this.showToast('Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ ÙÙŠ ØªÙˆÙÙŠØ±! ğŸ‰', 'success');
          }
          
          setTimeout(() => this.router.navigate(['/tabs/tab1']), 2000);
        } else {
          await loading.dismiss();
          await this.showToast('ÙØ´Ù„ Ø¥ÙƒÙ…Ø§Ù„ Ø§Ù„ØªØ³Ø¬ÙŠÙ„', 'danger');
        }
      },
      error: async (error) => {
        await loading.dismiss();
        console.error('Profile completion error:', error);
        const errorMessage = error.error?.error || 'Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø¥ÙƒÙ…Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª';
        await this.showToast(errorMessage, 'danger');
      }
    });
  } catch (error: any) {
    await loading.dismiss();
    console.error('Complete signup error:', error);
    await this.showToast('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø¥ÙƒÙ…Ø§Ù„ Ø§Ù„ØªØ³Ø¬ÙŠÙ„', 'danger');
  }
}
